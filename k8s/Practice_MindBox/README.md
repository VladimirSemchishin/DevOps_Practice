# Тестовое задание Mindbox на позицию SRE

Решите задачу ниже. 

*Код должен открываться в браузере, без архивов, GitHub будет идеальным.*

**Задача**

*Не ожидаем production-ready решения. Сделайте, как кажется правильным, опишите процесс поиска и принятые решения.*

Опишите решение для веб-приложения в kubernetes в виде yaml-манифеста. Оставляйте в коде комментарии по принятым решениям. Есть следующие вводные:

- у нас мультизональный кластер (три зоны), в котором пять нод
- приложение требует около 5-10 секунд для инициализации
- по результатам нагрузочного теста известно, что 4 пода справляются с пиковой нагрузкой
- на первые запросы приложению требуется значительно больше ресурсов CPU, в дальнейшем потребление ровное в районе 0.1 CPU. По памяти всегда “ровно” в районе 128M memory
- приложение имеет дневной цикл по нагрузке – ночью запросов на порядки меньше, пик – днём
- хотим максимально отказоустойчивый deployment
- хотим минимального потребления ресурсов от этого deployment’а

***



# MindBox решение.

Я выполнил задачу в 2 вариантах
1. Единый манифест: [ссылка на единый манифест](https://github.com/VladimirSemchishin/DevOps_Practice/blob/main/k8s/Practice_MindBox/one-file-deploy-hpa-svc.yaml "one-file-deploy-hpa-svc.yaml")
2. [Ссылка на Chart](https://github.com/VladimirSemchishin/DevOps_Practice/tree/main/k8s/Practice_MindBox/Charm-Multi "Charm-Multi")

Отличие второго решения от первого:
- Есть возможность запустить приложение через Helm
- Прописаны переменные в файле [ссылка на values.yaml](https://github.com/VladimirSemchishin/DevOps_Practice/blob/main/k8s/Practice_MindBox/Charm-Multi/values.yaml "values.yaml"), в том числе переменная для имени проекта.
- Код расписан по соответвующим документам, что упрощает последующую модернизацию.

## Общий комментарий по решению задачи
Написал манифест, который разворчивает мультизональный кластер через k8s. Для практики я использовал провайдерв YandexCloud.
Там я создал мультизональный cluster, группу nodes, соответсвенно с 5 nodes  
![image](https://github.com/VladimirSemchishin/DevOps_Practice/assets/84544412/ae85925e-8052-4bc8-9c29-3305c74bc593)

### Реализация Deployment
Кратко по самому важному
- Использовал образ nginx:latest
- 1 pod - 1 контейнер
- Выделил контейнеру 0.1 CPU без указания лимита, поскольку по условию для запуска необходимо значительно больше чем 0.1 CPU
- Поскольку память около постоянная, выделил ей ровно то значение которое необходимо и установил лимит + 12M если вдруг она будет колебаться
- Реализовал проверки TCP liveness и TCP readiness. Поскольку на запуск необходимо от 5 до 10 секунд  liveness пробы начинаются на 5 и заканчиваются на 11 (интервал 3 секунда), количество проверок перед тем как сдаться установил 2, в случае если ответ получен не будет контейнер перезагрузится. После readiness начиная с 15 секнды начинает проверять (каждые 20 сек.) если нет ответа - контейнер уничтожается.

### Реализация HorizontalPodAutoscaler
Кратко по самому важному
- минимально кол-во рекплик 1, максимум 5  (для большей отказуустойчивости)
- реплика создается, когда pod начинает потреблять на 10% больше выделенных ему ресурсов

### Реализация Service
Кратко по самому важному
- установлен тип LoadBalancer на 80 порт. Порт приложения - 80 
  
## Проверка
Все работает
![image](https://github.com/VladimirSemchishin/DevOps_Practice/assets/84544412/16c6aaca-376b-43e5-8a9d-2c602b39bf30)

